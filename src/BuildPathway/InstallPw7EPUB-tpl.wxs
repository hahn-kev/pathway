<?xml version='1.0'?>
<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">
	<?define Version="%(PwVer)s"?>
	<?define UpgradeCode="C7CF2DA8-FD6B-4D6C-8F01-E6EFD6B273BA"?>
	<Product UpgradeCode="$(var.UpgradeCode)" Id="????????-????-????-????-????????????" 
		Name="%(Product)s$(var.Version)" Language="1033"
		Version="$(var.Version)" Manufacturer="SIL International">
		<Package Id="????????-????-????-????-????????????" 
			Manufacturer="SIL International" InstallerVersion="200" Compressed="yes"/>
		<Condition Message="You need to be an administrator to install this product.">Privileged</Condition>
		<Condition Message="[ProductName] will only run on Windows 2000 or better. You cannot intall it on this machine.">
			<![CDATA[(NOT Version9X) OR (NOT VersionNT OR (VersionNT >= 500))]]>
		</Condition>
		
		<!-- http://stackoverflow.com/questions/114165/how-to-implement-wix-installer-upgrade -->
		<Upgrade Id="$(var.UpgradeCode)">
			<!--  Detext any newer version of this product -->
			<UpgradeVersion Minimum="$(var.Version)"
				IncludeMinimum="no"
				OnlyDetect="yes"
				Language="1033"
				Property="NEWERVERSIONDETECTED" />
			<!--  Detect and remove any older version of this product -->
			<UpgradeVersion Maximum="$(var.Version)"
				IncludeMaximum="no"
				OnlyDetect="no"
				Language="1033"
				Property="OLDERVERSIONBEINGUPGRADED" />
		</Upgrade>
		
		<Media Id="1" Cabinet="pathway.cab" EmbedCab="yes" CompressionLevel="high"/>
		
		<Property Id="ALLUSERS"><![CDATA[1]]></Property>
		
		<InstallExecuteSequence>
			<RemoveExistingProducts After="InstallInitialize" />
		</InstallExecuteSequence>
		
		<FragmentRef Id="pathwayUI"/>
		<FragmentRef Id="FilesFragment"/>
		<FragmentRef Id="FeaturesFragment"/>

		<DirectoryRef Id="TARGETDIR">
			<Directory Id="DesktopFolder" SourceName="Desktop">
				<Component Id="DeskShortcutApp" Guid="FC2D322B-277A-42b8-BB3D-4039EFE026BE">
					<Condition><![CDATA[SIL_DESKTOP_ICONS]]></Condition>
					<Shortcut Id="DeskShortcutApp" Directory="DesktopFolder" Name="ConfigTo"
						LongName="Pathway Configuration Tool" Target="[#ConfigurationTool.exe]"
						Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
				</Component>
			</Directory>
			<Directory Id="StartMenuFolder" SourceName="StartMen" LongSource="Start Menu">
				<Directory Id="ProgramMenuFolder" SourceName="Programs">
					<Directory Id="PathwayMenu" Name="Pathway7">
						<Component Id="ShortcutApp" Guid="96BE5240-DC73-4b1c-A590-9FC7CFE71AEF">
							<Shortcut Id="ShortcutApp" Directory="PathwayMenu" Name="Pathway"
								LongName="Pathway Configuration Tool"
								Target="[#ConfigurationTool.exe]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="ReadMeShortcutApp"
							Guid="23575D91-3CF8-41dc-96FC-D2466EDE125C">
							<Shortcut Id="ReadMeShortcutApp" Directory="PathwayMenu" Name="ReadMe"
								Target="[#ReadMePw.rtf]" Hotkey="0" IconIndex="0" Show="normal"
								WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="TutorialShortcutApp"
							Guid="3A0CF01A-A7C3-49F0-A00F-0574B54370C9">
							<Shortcut Id="TutorialShortcutApp" Directory="PathwayMenu"
								Name="Tutorial" LongName="Student Manual"
								Target="[#Pathway_Student_Manual_BTE.doc]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="LicenseShortcutApp"
							Guid="23575D91-3CF8-41dc-96FC-D2466EDE125D">
							<Shortcut Id="LicenseShortcutApp" Directory="PathwayMenu" Name="License"
								LongName="License" Target="[#License.rtf]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="HelpShortcut" Guid="8D72119D-8590-4552-9A08-00AA4825FEF1">
							<Shortcut Id="HelpShortcut" Directory="PathwayMenu" Name="HelpFile"
								LongName="Pathway Help" Target="[#%(HelpFile)s]" Hotkey="0"
								IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
					</Directory>
				</Directory>
			</Directory>
		</DirectoryRef>
		<DirectoryRef Id="TARGETDIR">
			<Component Id="RegistryEntries" Guid="371D3AFA-C611-4928-89E5-6BC00EDA2EAB">
				<Registry Root="HKLM" Action="createKeyAndRemoveKeyOnUninstall"
					Key="Software\SIL\Pathway"/>
				<Registry Root="HKLM" Action="write" Key="Software\SIL\Pathway" Name="PathwayDir"
					Type="string" Value="[INSTALLDIR]"/>
				<!-- cf. http://msdn.microsoft.com/en-us/library/aa367992.aspx -->
				<Registry Root="HKLM" Action="write" Key="Software\SIL\Pathway" Name="WritingSystemStore"
					Type="string" Value="[CommonAppDataFolder]SIL\WritingSystemStore\"/>
			</Component>
		</DirectoryRef>
	</Product>
</Wix>
