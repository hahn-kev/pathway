<?xml version='1.0'?>
<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">
	<?define Version="%(PwVer)s"?>
	<?define UpgradeCode="2CAD8F8F-2EC0-486B-B46A-90B2CD12F1D7"?>
	<Product UpgradeCode="$(var.UpgradeCode)" Id="????????-????-????-????-????????????"
		Name="%(Product)s$(var.Version) for FieldWorks %(FwVer)s" Language="1033" 
		Version="$(var.Version)" Manufacturer="SIL International">
		<Package Id="????????-????-????-????-????????????" Manufacturer="SIL International"
			InstallerVersion="200" Compressed="yes"/>
		<Condition Message="You need to be an administrator to install this product.">Privileged</Condition>
		<Condition
			Message="[ProductName] will only run on Windows 2000 or better. You cannot intall it on this machine.">
			<![CDATA[(NOT Version9X) OR (NOT VersionNT OR (VersionNT >= 500))]]>
		</Condition>
		<!--Condition Message="[ProductName] will only run with SIL FieldWorks 5.4 or later. You must first install a suitable version of FieldWorks.">
			<![CDATA[FWDATE >= "2008-09-30"]]>
		</Condition-->

		<Upgrade Id="$(var.UpgradeCode)">
			<!--  Detext any newer version of this product -->
			<UpgradeVersion Minimum="$(var.Version)"
				IncludeMinimum="no"
				OnlyDetect="yes"
				Language="1033"
				Property="NEWPRODUCTFOUND" />
			<!--  Detect and remove any older version of this product -->
			<UpgradeVersion Maximum="$(var.Version)"
				IncludeMaximum="yes"
				OnlyDetect="no"
				Language="1033"
				Property="OLDPRODUCTFOUND" />
		</Upgrade>
		
		<Media Id="1" Cabinet="pathway.cab" EmbedCab="yes" CompressionLevel="high"/>

		<Property Id="FWDIR60" Value="null">
			<RegistrySearch Id="FindFwInstallDir60" Key="SOFTWARE\SIL\FieldWorks" Name="RootCodeDir"
				Root="HKLM" Type="directory"/>
		</Property>
		<!-- Property Id="FWDIR70" Value="null">
			<RegistrySearch Id="FindFwInstallDir70" Key="SOFTWARE\SIL\FieldWorks\7.0" Name="RootCodeDir" Root="HKLM" Type="directory"/>
		</Property>
		<Property Id="FWDIR80" Value="null">
			<RegistrySearch Id="FindFwInstallDir80" Key="SOFTWARE\SIL\FieldWorks\8.0" Name="RootCodeDir" Root="HKLM" Type="directory"/>
			</Property -->

		<CustomAction Id="PreventDowngrading" Error="Newer version already installed." />
		
		<CustomAction Id="SetFwDir60" Property="FWDIR" Value="[FWDIR60]"/>
		<!-- CustomAction Id="SetFwDir70" Property="FWDIR" Value="[FWDIR70]" />
		<CustomAction Id="SetFwDir80" Property="FWDIR" Value="[FWDIR80]" / -->
		
		<InstallExecuteSequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
			<RemoveExistingProducts After="InstallFinalize" />
		</InstallExecuteSequence>
		
		<InstallUISequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
			<Custom Action="SetFwDir60" After="AppSearch"><![CDATA[FWDIR60 <> "null"]]></Custom>
			<!-- Custom Action="SetFwDir70" After="SetFwDir60"><![CDATA[FWDIR70 <> "null"]]></Custom>
			<Custom Action="SetFwDir80" After="SetFwDir70"><![CDATA[FWDIR80 <> "null"]]></Custom -->
		</InstallUISequence>

		<Property Id="FWDATE">
			<RegistrySearch Id="FindFwDate" Key="SOFTWARE\SIL\FieldWorks\CoreInstallation"
				Root="HKLM" Type="raw"/>
		</Property>
		<Property Id="ALLUSERS"><![CDATA[1]]></Property>
		
		<FragmentRef Id="pathwayUI"/>
		<FragmentRef Id="FilesFragment"/>
		<FragmentRef Id="FeaturesFragment"/>

		<DirectoryRef Id="TARGETDIR">
			<Directory Id="DesktopFolder" SourceName="Desktop">
				<Component Id="DeskShortcutApp" Guid="FC2D322B-277A-42b8-BB3D-4039EFE026BE">
					<Condition><![CDATA[SIL_DESKTOP_ICONS]]></Condition>
					<Shortcut Id="DeskShortcutApp" Directory="DesktopFolder" Name="ConfigTo"
						LongName="Pathway Configuration Tool" Target="[#ConfigurationTool.exe]"
						Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
				</Component>
			</Directory>
			<Directory Id="StartMenuFolder" SourceName="StartMen" LongSource="Start Menu">
				<Directory Id="ProgramMenuFolder" SourceName="Programs">
					<Directory Id="PathwayMenu" Name="Pathway">
						<Component Id="ShortcutApp" Guid="96BE5240-DC73-4b1c-A590-9FC7CFE71AEF">
							<Shortcut Id="ShortcutApp" Directory="PathwayMenu" Name="Pathway"
								LongName="Pathway Configuration Tool"
								Target="[#ConfigurationTool.exe]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="ReadMeShortcutApp"
							Guid="23575D91-3CF8-41dc-96FC-D2466EDE125C">
							<Shortcut Id="ReadMeShortcutApp" Directory="PathwayMenu" Name="ReadMe"
								Target="[#ReadMePw.rtf]" Hotkey="0" IconIndex="0" Show="normal"
								WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="TutorialShortcutApp"
							Guid="3A0CF01A-A7C3-49F0-A00F-0574B54370C9">
							<Shortcut Id="TutorialShortcutApp" Directory="PathwayMenu"
								Name="Tutorial" LongName="Student Manual"
								Target="[#Pathway_Student_Manual_SE.doc]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="LicenseShortcutApp"
							Guid="23575D91-3CF8-41dc-96FC-D2466EDE125D">
							<Shortcut Id="LicenseShortcutApp" Directory="PathwayMenu" Name="License"
								LongName="License" Target="[#License.rtf]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="HelpShortcut" Guid="3B486DB7-4215-4cf5-976E-23EED749D60B">
							<Shortcut Id="HelpShortcut" Directory="PathwayMenu" Name="HelpFile"
								LongName="Pathway Help" Target="[#%(HelpFile)s]" Hotkey="0"
								IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
					</Directory>
				</Directory>
			</Directory>
		</DirectoryRef>
	</Product>
</Wix>
