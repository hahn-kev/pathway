<?xml version='1.0'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2003/01/wi'>
	<?define Version="%(PwVer)s"?>
	<?define UpgradeCode="BBE89DCC-7BA6-4c37-A6E7-0BA8F2AB1C05"?>
	<Product UpgradeCode="$(var.UpgradeCode)" Id="????????-????-????-????-????????????"
		Name='FieldWorks Text Export %(PwVer)s' Language='1033' 
		Version='$(var.Version)' Manufacturer='SIL International'>
		<Package Id='????????-????-????-????-????????????' 
			Manufacturer='SIL International' InstallerVersion='200' Compressed='yes' />
		<Condition Message="You need to be an administrator to install this product.">Privileged</Condition>
		<Condition Message="[ProductName] will only run on Windows 2000 or better. You cannot intall it on this machine.">
			<![CDATA[(NOT Version9X) OR (NOT VersionNT OR (VersionNT >= 500))]]>
		</Condition>

		<Upgrade Id="$(var.UpgradeCode)">
			<!--  Detext any newer version of this product -->
			<UpgradeVersion Minimum="$(var.Version)"
				IncludeMinimum="no"
				OnlyDetect="yes"
				Language="1033"
				Property="NEWPRODUCTFOUND" />
			<!--  Detect and remove any older version of this product -->
			<UpgradeVersion Maximum="$(var.Version)"
				IncludeMaximum="yes"
				OnlyDetect="no"
				Language="1033"
				Property="OLDPRODUCTFOUND" />
		</Upgrade>

		<Media Id='1' Cabinet='PwTxEx.cab' EmbedCab='yes' CompressionLevel='high'/>

		<CustomAction Id="PreventDowngrading" Error="Newer version already installed." />

		<InstallExecuteSequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
			<RemoveExistingProducts After="InstallFinalize" />
		</InstallExecuteSequence>
		
		<InstallUISequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
		</InstallUISequence>
		
		<FragmentRef Id='PwTxExUI'/>
		<FragmentRef Id='FilesFragment'/>
		<FragmentRef Id='FeaturesFragment'/>

		<DirectoryRef Id="TARGETDIR">
			<Directory Id="StartMenuFolder" SourceName="StartMen" LongSource="Start Menu">
				<Directory Id="ProgramMenuFolder" SourceName="Programs">
					<Directory Id="PwTxExMenu" Name="PwTxEx">
						<Component Id="ShortcutApp" Guid="{6A6AC95D-2E70-48d2-AA52-3C500529BE25}">
							<Shortcut Id="ShortcutApp" Directory="PwTxExMenu" Name="TxEx" LongName="FieldWorks Text Export" Target="[#TextExport.exe]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
						<Component Id="ReadMeShortcutApp" Guid="AD4C7266-0B90-4cba-BC77-16AF02C6607D">
							<Shortcut Id="ReadMeShortcutApp" Directory="PwTxExMenu" Name="ReadMe" LongName="ReadMe" Target="[#ReadMePw.rtf]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
						<Component Id="LicenseShortcutApp" Guid="574B4251-982F-47d2-ACB5-5E92D4D24BD3">
							<Shortcut Id="LicenseShortcutApp" Directory="PwTxExMenu" Name="License" LongName="License" Target="[#License.rtf]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
					</Directory>
				</Directory>
			</Directory>
		</DirectoryRef>
		<DirectoryRef Id="TARGETDIR">
			<Component Id="RegistryEntries" Guid="0F2618E5-C085-42f1-9618-9EAAC8E972F6">
				<Registry Root="HKLM" Action="createKeyAndRemoveKeyOnUninstall" 
					Key="Software\SIL\PwTxEx" />
				<Registry Root="HKLM" Action="write" 
					Key="Software\SIL\PwTxEx" Name="ConTeXtDir" Type="string" Value="[PwTxExFolder]" />
			</Component>
		</DirectoryRef>
	</Product>
</Wix>
