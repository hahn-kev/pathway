<?xml version='1.0'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2003/01/wi'>
	<?define Version="%(PwVer)s"?>
	<?define UpgradeCode="7480FCC4-CD9E-4CA5-BE46-8DE123AAACD7"?>
	<?define YouVersionVersion="1.0"?>
	<Product UpgradeCode="$(var.UpgradeCode)" Id="????????-????-????-????-????????????"
		Name='Pathway YouVersion %(PwVer)s-$(var.YouVersionVersion)' Language='1033' Version='$(var.Version)-$(var.YouVersionVersion)' Manufacturer='SIL International'>
		<Package Id='????????-????-????-????-????????????' Manufacturer='SIL International' InstallerVersion='200' Compressed='yes' />
		<Condition Message="You need to be an administrator to install this product.">Privileged</Condition>
		<Condition Message="[ProductName] will only run on Windows 2000 or better. You cannot intall it on this machine.">
			<![CDATA[(NOT Version9X) OR (NOT VersionNT OR (VersionNT >= 500))]]>
		</Condition>

		<Upgrade Id="$(var.UpgradeCode)">
			<!--  Detext any newer version of this product -->
			<UpgradeVersion Minimum="$(var.Version)"
				IncludeMinimum="no"
				OnlyDetect="yes"
				Language="1033"
				Property="NEWPRODUCTFOUND" />
			<!--  Detect and remove any older version of this product -->
			<UpgradeVersion Maximum="$(var.Version)"
				IncludeMaximum="yes"
				OnlyDetect="no"
				Language="1033"
				Property="OLDPRODUCTFOUND" />
		</Upgrade>
		
		<Media Id='1' Cabinet='YouVersion.cab' EmbedCab='yes' CompressionLevel='high'/>

		<CustomAction Id="PreventDowngrading" Error="Newer version already installed." />
		
		<InstallExecuteSequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
			<RemoveExistingProducts After="InstallFinalize" />
		</InstallExecuteSequence>
		
		<InstallUISequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
		</InstallUISequence>

		<Property Id="ALLUSERS"><![CDATA[1]]></Property>
		
		<FragmentRef Id='pathwayUI'/>
		<FragmentRef Id='FilesFragment'/>
		<FragmentRef Id='FeaturesFragment'/>

		<DirectoryRef Id="TARGETDIR">
			<Directory Id="StartMenuFolder" SourceName="StartMen" LongSource="Start Menu">
				<Directory Id="ProgramMenuFolder" SourceName="Programs">
					<Directory Id="YouVersionMenu" LongName="Pathway YouVersion" Name="PwYouVer">
						<Component Id="ReadMeShortcutApp" Guid="55E9E949-A652-4f44-A431-B02605F420D9">
							<Shortcut Id="ReadMeShortcutApp" Directory="YouVersionMenu" Name="ReadMe" LongName="ReadMe" Target="[#ReadMePw.rtf]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
						<Component Id="LicenseShortcutApp" Guid="EB5EAB65-073C-4779-83ED-367438C1115A">
							<Shortcut Id="LicenseShortcutApp" Directory="YouVersionMenu" Name="License" LongName="License" Target="[#License.rtf]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
					</Directory>
				</Directory>
			</Directory>
		</DirectoryRef>
		<DirectoryRef Id="TARGETDIR">
			<Component Id="RegistryEntries" Guid="19E7B5B1-C731-42C4-848E-4BBBDC80BD85">
				<Registry Root="HKLM" Action="createKeyAndRemoveKeyOnUninstall" 
					Key="Software\SIL\PathwayYouVersion" />
				<Registry Root="HKLM" Action="write" 
					Key="Software\SIL\PathwayYouVersion" Name="YouVersionDir" Type="string" Value="[INSTALLDIR]" />
				<Registry Root="HKLM" Action="write" 
					Key="Software\SIL\PathwayYouVersion" Name="YouVersionVer" Type="string" Value="$(var.YouVersionVersion)" />
			</Component>
		</DirectoryRef>
	</Product>
</Wix>
