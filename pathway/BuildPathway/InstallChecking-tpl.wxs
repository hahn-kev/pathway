<?xml version='1.0'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2003/01/wi'>
	<?define Version="%(PwVer)s"?>
	<?define UpgradeCode="BD7E14AE-CB6D-4da1-BE6A-C805972471B1"?>
	<Product UpgradeCode="$(var.UpgradeCode)" Id="????????-????-????-????-????????????"
		Name='Pathway Checking %(PwVer)s' Language='1033' Version='$(var.Version)' Manufacturer='SIL International'>
		<Package Id='????????-????-????-????-????????????' Manufacturer='SIL International' InstallerVersion='200' Compressed='yes' />
		<Condition Message="You need to be an administrator to install this product.">Privileged</Condition>
		<Condition Message="[ProductName] will only run on Windows 2000 or better. You cannot intall it on this machine.">
			<![CDATA[(NOT Version9X) OR (NOT VersionNT OR (VersionNT >= 500))]]>
		</Condition>

		<Upgrade Id="$(var.UpgradeCode)">
			<!--  Detext any newer version of this product -->
			<UpgradeVersion Minimum="$(var.Version)"
				IncludeMinimum="no"
				OnlyDetect="yes"
				Language="1033"
				Property="NEWPRODUCTFOUND" />
			<!--  Detect and remove any older version of this product -->
			<UpgradeVersion Maximum="$(var.Version)"
				IncludeMaximum="yes"
				OnlyDetect="no"
				Language="1033"
				Property="OLDPRODUCTFOUND" />
		</Upgrade>
		
		<Media Id='1' Cabinet='Checking.cab' EmbedCab='yes' CompressionLevel='high'/>

		<CustomAction Id="PreventDowngrading" Error="Newer version already installed." />
		
		<InstallExecuteSequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
			<RemoveExistingProducts After="InstallFinalize" />
		</InstallExecuteSequence>
		
		<InstallUISequence>
			<Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
		</InstallUISequence>
		
		<FragmentRef Id='pathwayUI'/>
		<FragmentRef Id='FilesFragment'/>
		<FragmentRef Id='FeaturesFragment'/>

		<DirectoryRef Id="TARGETDIR">
			<Directory Id="DesktopFolder" SourceName="Desktop">
				<Component Id="DeskShortcutUsxChars" Guid="3D3E8B73-45B2-4705-830B-950624CC756F">
					<Condition><![CDATA[SIL_DESKTOP_ICONS]]></Condition>
					<Shortcut Id="DeskShortcutUsxChars" Directory="DesktopFolder" Name="usxChars"
						LongName="Pathway Char Check" Target="[#usxChars.exe]"
						Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
				</Component>
				<Component Id="DeskShortcutUsxVrsWrdCnt" Guid="CE87802C-4545-4496-9572-6E6EDEE93E05">
					<Condition><![CDATA[SIL_DESKTOP_ICONS]]></Condition>
					<Shortcut Id="DeskShortcutUsxVrsWrdCnt" Directory="DesktopFolder" Name="usxVWC"
						LongName="Pathway Verse Word Count" Target="[#usxVerseWordCount.exe]"
						Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
				</Component>
				<Component Id="DeskShortcutXmlMarkup" Guid="174F3CA1-A023-4c58-A25F-0E7FDD2177F7">
					<Condition><![CDATA[SIL_DESKTOP_ICONS]]></Condition>
					<Shortcut Id="DeskShortcutXmlMarkup" Directory="DesktopFolder" Name="xmlMarkU"
						LongName="Pathway Markup Check" Target="[#xmlMarkup.exe]"
						Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR"/>
				</Component>
			</Directory>
			<Directory Id="StartMenuFolder" SourceName="StartMen" LongSource="Start Menu">
				<Directory Id="ProgramMenuFolder" SourceName="Programs">
					<Directory Id="CheckingMenu" LongName="Pathway Checking" Name="PwCheck">
						<Component Id="ShortcutUsxChars" Guid="C3CDF5FB-1644-458e-B529-FFDF49503A31">
							<Shortcut Id="ShortcutUsxChars" Directory="CheckingMenu" Name="usxChars"
								LongName="Pathway Char Check"
								Target="[#usxChars.exe]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="ShortcutVrsWrdCnt" Guid="8E359113-A926-4111-B17A-D02BC8D9C9BF">
							<Shortcut Id="ShortcutVrsWrdCnt" Directory="CheckingMenu" Name="usxVWC"
								LongName="Pathway Verse Word Count"
								Target="[#usxVerseWordCount.exe]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="ShortcutXmlMarkup" Guid="FD5BFC90-C089-43d9-84A2-2548036BDCA0">
							<Shortcut Id="ShortcutXmlMarkup" Directory="CheckingMenu" Name="xmlMarkU"
								LongName="Pathway Markup Check"
								Target="[#xmlMarkup.exe]" Hotkey="0" IconIndex="0"
								Show="normal" WorkingDirectory="INSTALLDIR"/>
						</Component>
						<Component Id="ReadMeShortcutApp" Guid="55E9E949-A652-4f44-A431-B02605F420D9">
							<Shortcut Id="ReadMeShortcutApp" Directory="CheckingMenu" Name="ReadMe" LongName="ReadMe" Target="[#ReadMePw.rtf]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
						<Component Id="LicenseShortcutApp" Guid="EB5EAB65-073C-4779-83ED-367438C1115A">
							<Shortcut Id="LicenseShortcutApp" Directory="CheckingMenu" Name="License" LongName="License" Target="[#License.rtf]" Hotkey="0" IconIndex="0" Show="normal" WorkingDirectory="INSTALLDIR" />
						</Component>
					</Directory>
				</Directory>
			</Directory>
		</DirectoryRef>
		<DirectoryRef Id="TARGETDIR">
			<Component Id="RegistryEntries" Guid="A0CED29A-AA2B-46fc-BBBD-944ACE5DD6CC">
				<Registry Root="HKLM" Action="createKeyAndRemoveKeyOnUninstall" 
					Key="Software\SIL\PathwayChecking" />
				<Registry Root="HKLM" Action="write" 
					Key="Software\SIL\PathwayChecking" Name="CheckingDir" Type="string" Value="[INSTALLDIR]" />
			</Component>
		</DirectoryRef>
	</Product>
</Wix>
