; Flex XHTML Export Script
; ========================
;
; OS:     Windows 9x/NT
; Author: Greg Trihus <greg_trihus@sil.org>
;
; Runs fieldworks to export YCE-Test as XHTML

IfEqual,proj,,SetEnv,proj,YCE-Test
IFEqual,Backup,,SetEnv,Backup,YCE-Test 2010-11-04 1357.fwbackup
IfEqual,IncOpt,,SetEnv,IncOpt,c
IfEqual,InputPath,,SetEnv,InputPath,c:\\svn\\btai\\Tests
IfEqual,OutputPath,,SetEnv,OutputPath,C:\\svn\\XhtmlData
;MsgBox, 4, AutoIt Flex XHTML Export, Run Fieldworks and export \"%proj%\" as XHTML. Run?
;IfMsgBox, NO, Goto, denied

ifExist,%FW_HOME%\\FieldWorks.exe, Goto, GotHome
RegRead,FW_HOME,REG_SZ,HKEY_LOCAL_MACHINE,Software\\SIL\\Fieldworks\\7.0,RootCodeDir
ifExist,%FW_HOME%\\FieldWorks.exe, Goto, GotHome
RegRead,FW_HOME,REG_SZ,HKEY_LOCAL_MACHINE,Software\\Wow6432Node\\SIL\\Fieldworks\\7.0,RootCodeDir
ifExist,%FW_HOME%\\FieldWorks.exe, Goto, GotHome
SetEnv,FW_HOME,%FW_HOME%\\..\\Output\\Debug
ifExist,%FW_HOME%\\FieldWorks.exe, Goto, GotHome
MsgBox, 48, Missing FieldWorks 7, Unable to find location of FieldWorks 7
Goto, denied

GotHome:
;MsgBox,4112,Run Command, "%FW_HOME%\\Fieldworks.exe" -app Flex -db "%proj%" -restore "%InputPath%\\%Backup%" -include %IncOpt%
Run, "%FW_HOME%\\Fieldworks.exe" -app Flex -db "%proj%" -restore "%InputPath%\\%Backup%" -include %IncOpt%
WinWaitActive, %proj% - FieldWorks Language Explorer
Send, !fe{DOWN 5}{ENTER}
sfmBox:
WinWaitActive, Export to SFM,,200
ifEqual,errorlevel,1, Goto, xhtmlBox
Send, {Esc}{Down}{ENTER}
xhtmlBox:
WinWaitActive, Export to XHTML,,200
ifEqual,errorlevel,1, Goto, sfmBox
Send, %OutputPath%\\%proj%.xhtml{ENTER}
WinWaitActive,output
Send, !{F4}
WinWaitActive,%proj% - FieldWorks Language Explorer,Lexicon
Send, !{F4}
WinWaitClose,%proj% - FieldWorks Language Explorer

denied:
Exit

[ADLIB]
Global Writing Systems Changed,writing systems were updated,Send, !n
Confirm Save As,,Send, !y